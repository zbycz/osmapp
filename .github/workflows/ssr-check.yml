name: Check server-side rendering
run-name: Check server-side rendering (${{ github.event.deployment_status.environment }})
on: deployment_status
jobs:
  check-ssr:
    # only for vercel "preview" deployments (It is not our production)
    if: github.event.deployment_status.state == 'success'
      && (github.event.deployment_status.environment == 'Preview' || github.event.deployment_status.environment == 'Production')
    runs-on: ubuntu-latest
    steps:
      - name: Check if node/6 is ssr rendered
        env:
          ENV_URL: ${{ github.event.deployment_status.environment_url }}
        run: |
          URL=$(echo "$ENV_URL")/node/6
          echo "Fetch the URL: $URL"
          curl -v $URL | grep -q "Originally Deton√°tor route (this message used for SSR check)"
          if [ $? -eq 0 ]; then
              echo "Server-side rendering is working"
          else
              echo "Server-side rendering broken"
              exit 1
          fi
