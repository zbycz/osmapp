name: Deploy na zby.cz

on:
  push:
  # branches:
  #   - master

jobs:
  build_and_deploy:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v3
        with:
          node-version: 20.x
          cache: 'yarn'

      - name: Install dependencies
        run: yarn install

      - name: Build project
        run: yarn build

      - name: Create zip archive
        run: zip -r build.zip build/

      - name: Upload to zby.cz
        run: |
          COMMIT_HASH=$(git rev-parse --short "$GITHUB_SHA")
          COMMIT_MESSAGE=$(git log -1 --pretty=%B)
          curl 'https://upload.zby.cz/' \
            -H 'Content-Type: multipart/form-data' \
            --form "file=@build.zip" \
            --form "commit_hash=$COMMIT_HASH" \
            --form "commit_message=$COMMIT_MESSAGE"
